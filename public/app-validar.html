<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Valida√ß√£o por QR Code - Cart√£o AproveitAI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: linear-gradient(180deg,#dfffe6,#bdefff);
}

header {
  background:#fff;
  padding:20px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:3px solid #1f8a4c;
}

header img { height:60px; }

header h1 {
  margin:0;
  color:#1f8a4c;
}

.sub {
  background:#d9ffe3;
  padding:12px;
  text-align:center;
  font-weight:bold;
}

.container {
  max-width:650px;
  margin:40px auto;
  background:#fff;
  padding:30px;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
}

.btn {
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  background:#157a3b;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}

.btn:hover { background:#0f5f2e; }

input {
  width:100%;
  padding:12px;
  margin-bottom:12px;
  font-size:15px;
}

.result {
  margin-top:20px;
  padding:18px;
  border-radius:10px;
  text-align:center;
}

.ativo {
  background:#d4f8df;
  color:#0a7a2a;
  font-weight:bold;
}

.inativo {
  background:#f8d4d4;
  color:#a00000;
  font-weight:bold;
}

footer {
  margin-top:40px;
  padding:15px;
  text-align:center;
  font-size:12px;
  background:#e8fff0;
}
</style>
</head>

<body>

<header>
  <img src="logo-prometheus.png">
  <h1>Cart√£o AproveitAI</h1>
  <img src="logo-aproveitai.png">
</header>

<div class="sub">
üîê Valida√ß√£o por QR Code ‚Äî √Årea exclusiva do parceiro
</div>

<div class="container">

<h3 id="parceiroInfo"></h3>

<button class="btn" onclick="abrirCamera()">üì∑ Leitor de QR Code</button>

<hr style="margin:25px 0">

<h3>Consulta Manual</h3>

<input id="cpf" placeholder="CPF do cliente">
<input id="idPublico" placeholder="ID P√∫blico (APV-XXXX)">

<button class="btn" onclick="validar()">Validar Cliente</button>

<div id="resultado"></div>

</div>

<footer>
¬© 2025 Cart√£o AproveitAI ‚Äì PROMETHEUS EROPRO<br>
Benef√≠cios definidos pelos parceiros. Pagamentos √† vista.
</footer>

<script>
/* ===============================
   BLOQUEIO DE ACESSO DIRETO
================================ */
const sessao = JSON.parse(localStorage.getItem("sessaoParceiro"));

if (!sessao || sessao.ativo !== "SIM") {
  alert("Acesso restrito. Fa√ßa login como parceiro.");
  window.location.href = "login-app.html";
}

document.getElementById("parceiroInfo").innerText =
  "Parceiro logado: " + sessao.parceiro_nome + " | CNPJ: " + sessao.parceiro_cnpj;

/* ===============================
   URL DO GOOGLE SCRIPT
================================ */
const API_URL = "COLE_AQUI_SUA_URL_DO_APPS_SCRIPT";

/* ===============================
   VALIDA√á√ÉO
================================ */
function validar() {
  const cpf = document.getElementById("cpf").value.trim();
  const idPublico = document.getElementById("idPublico").value.trim();

  if (!cpf && !idPublico) {
    alert("Informe CPF ou ID P√∫blico");
    return;
  }

  const url =
    API_URL +
    "?acao=validar" +
    "&cpf=" + encodeURIComponent(cpf) +
    "&idPublico=" + encodeURIComponent(idPublico) +
    "&parceiro=" + encodeURIComponent(sessao.parceiro_nome) +
    "&cnpj=" + encodeURIComponent(sessao.parceiro_cnpj);

  fetch(url)
    .then(r => r.text())
    .then(txt => {
      let data;
      try {
        data = JSON.parse(txt);
      } catch {
        alert("Erro na resposta do servidor");
        return;
      }

      mostrarResultado(data);
    });
}

function mostrarResultado(d) {
  const div = document.getElementById("resultado");

  if (d.status === "ATIVO") {
    div.innerHTML = `
      <div class="result ativo">
        ATIVO<br>
        ${d.nome}<br>
        C√≥digo: ${d.codigo_ero}
      </div>`;
  } else {
    div.innerHTML = `
      <div class="result inativo">
        INATIVO<br>
        ${d.nome || "Cliente n√£o ativo"}
      </div>`;
  }
}

/* ===============================
   C√ÇMERA (placeholder)
================================ */
function abrirCamera() {
  alert("Leitor de QR Code ativo (HTTPS confirmado)");
}
</script>

</body>
</html>
