<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Meu Cart√£o | Cart√£o AproveitAI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#bfefff;
}

/* =========================
   CABE√áALHO
========================= */
.site-header {
  background: white;
  padding: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.brandline {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 15px;
  flex-wrap: wrap;
}

.logo {
  max-height: 180px;
  height: auto;
  width: auto;
  object-fit: contain;
}

.brand-center {
  flex: 1;
  text-align: center;
}

.site-title {
  font-size: 36px;
  color: #0a7a2a;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
  font-weight: bold;
}

.slogan {
  font-size: 16px;
  font-style: italic;
  margin-bottom: 5px;
  color: #555;
}

.boas-vindas {
  background: #dfffe0;
  padding: 12px 15px;
  border-radius: 8px;
  margin-top: 10px;
  font-size: 18px; /* AUMENTADO */
  line-height: 1.5;
  font-weight: 600;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}

/* ================= CART√ÉO ================= */
.cartao-dobravel{
  display:flex;
  width:17.2cm;
  min-height:5.4cm;
  margin:25px auto;
  background:#f0fff0;
  border:2px dashed #1c8f3c;
  border-radius:10px;
  overflow:hidden;
}
.cartao-lado{
  width:50%;
  padding:10px;
  box-sizing:border-box;
}
.cartao-esquerdo img{
  width:80px;
}
.dados-cartao p{
  margin:4px 0;
  font-size:13px;
}
.dados-cartao b{
  color:#0a7a2a;
  min-width:120px;
  display:inline-block;
}
.linha-dobra{
  width:1px;
  background:#1c8f3c;
}
.cartao-direito{
  text-align:center;
}
.qr-img{
  width:90px;
  height:90px;
  margin:8px auto;
}
.aviso{
  font-size:10px;
}
.atencao{
  color:#b80000;
  font-weight:bold;
}
.suporte{
  font-size:9px;
}

/* ================= BOT√ïES ================= */
.botoes{
  text-align:center;
  margin:20px 0;
}
.botoes button{
  background:#1c8f3c;
  color:#fff;
  border:none;
  padding:10px 22px;
  margin:6px;
  border-radius:8px;
  font-size:15px;
  cursor:pointer;
}
.botoes button.voltar{
  background:#005bb5;
}

/* =========================
   RODAP√â
========================= */
.footer {
  background: #dfffe0;
  color: #222;
  padding: 10px 10px;
  font-size: 13px;
  border-top: 3px solid white;
}

.footer-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: flex-start;
  gap: 10px;
  max-width: 1000px;
  margin: auto;
  padding: 5px 0;
}

.footer a {
  color: #0066cc;
  font-size: 13px;
}

.footer-bottom {
  text-align: center;
  margin-top: 5px;
  font-size: 11px;
}

/* ================= IMPRESS√ÉO ================= */
@media print{
  body{background:#fff;}
  .botoes,.site-header,.footer{display:none;}
}
#cartao-digital{
  max-width: 100%;
  overflow: hidden;
}

.cartao-container{
  display: flex;
  flex-wrap: wrap;
}

.cartao-esquerda,
.cartao-direita{
  width: 100%;
}

@media (min-width: 768px){
  .cartao-esquerda,
  .cartao-direita{
    width: 50%;
  }
}

img, canvas{
  max-width: 100%;
  height: auto;
}
#cartao {
  max-width: 100%;
  overflow-x: hidden;
  box-sizing: border-box;
}

@media (max-width: 600px) {
  #cartao {
    transform: scale(0.95);
    transform-origin: top center;
  }
}

</style>
</head>

<body>

<!-- ‚úÖ CABE√áALHO PADRONIZADO -->
<header class="site-header">
  <div class="brandline">
    <img src="logo-prometheus.png" class="logo logo-prometheus">
    <div class="brand-center">
      <h1 class="site-title">Cart√£o AproveitAI</h1>
      <p class="slogan">Tecnologia com Consci√™ncIA gera Resultado.</p>

      <!-- Tarja -->
      <p class="boas-vindas">
        üè™ <strong>CART√ÉO DIGITAL</strong><br>
        SALVE, IMPRIMA aproveite os beneficios.
      </p>
    </div>
    <img src="logo-aproveitai.png" class="logo logo-aproveitai">
  </div>
</header>
<div style="
  background:#fff3cd;
  color:#856404;
  padding:8px;
  text-align:center;
  font-size:13px;
">
  ‚ö†Ô∏è Descontos sujeitos √† valida√ß√£o no sistema e √†s regras do parceiro.
</div>

<!-- CART√ÉO -->

<div class="cartao-dobravel" id="cartao-print">

  <div class="cartao-lado cartao-esquerdo">
    <img src="logo-aproveitai.png">
    <div class="dados-cartao">
      <p><b>Nome:</b> <span id="nome">-</span></p>
      <p><b>CPF:</b> <span id="cpf">-</span></p>
      <p><b>ID P√∫blico:</b> <span id="idPublico">-</span></p>
      <p><b>Grupo:</b> <span id="grupo">-</span></p>
      <p><b>Cidade:</b> <span id="cidade">-</span></p>
      <p><b>Cadastro:</b> <span id="dataAceite">-</span></p>
    </div>
  </div>

  <div class="linha-dobra"></div>

  <div class="cartao-lado cartao-direito">
    <h4>Valida√ß√£o</h4>
    <img id="qrCode" class="qr-img">
    <div class="aviso">
      Apresente documento com foto se solicitado.<br>
      <span class="atencao">Valide sempre antes da compra.</span>
    </div>
    <div class="suporte">
      SUPORTE - (28) 99969-2303<br>
      cartao.aproveitai@gmail.com<br>
      www.aproveitai.com.br
    </div>
  </div>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<!-- BOT√ïES -->
<div class="botoes">
<button onclick="salvarPDF()">üíæ Salvar cart√£o em PDF</button>
<button onclick="window.print()">üñ®Ô∏è Imprimir cart√£o</button>
<button class="voltar" onclick="history.back()">‚¨Ö Voltar</button>
</div>

<!-- ‚úÖ RODAP√â PADR√ÉO -->
<footer style="
  background:#dfffe0;
  padding:12px;
  text-align:center;
  font-size:12px;
  line-height:1.4;
">
  ¬© 2025 Cart√£o AproveitAI ‚Ä¢ PROMETHEUS EROPRO<br>

  <strong>Aviso legal:</strong> O Cart√£o AproveitAI n√£o garante descontos.
  Benef√≠cios e promo√ß√µes s√£o definidos e concedidos exclusivamente pelos parceiros,
  v√°lidos, em regra, para pagamentos √† vista em meda corrente, salvo autoriza√ß√£o expressa do estabelecimento.
</footer>

<!-- ================= SCRIPT ================= -->
<script>
const API = "https://script.google.com/macros/s/AKfycbzhwXhtWdsDSuABRneoz6QAD1SxpnMq3vc8e1FhtknlB7_1j6qLjYIbPA0qPJS7ck7y/exec";
const id = new URLSearchParams(location.search).get("id");

function jsonp(url){
  return new Promise((resolve, reject) => {
    const cb = "cb_" + Math.random().toString(36).slice(2);
    window[cb] = (data) => { resolve(data); cleanup(); };
    const s = document.createElement("script");
    s.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cb;
    s.onerror = () => { reject(new Error("JSONP_FAIL")); cleanup(); };
    document.body.appendChild(s);
    function cleanup(){
      try{ delete window[cb]; }catch(e){ window[cb]=undefined; }
      if(s && s.parentNode) s.parentNode.removeChild(s);
    }
  });
}

(async () => {
  if(!id){ alert("ID do cart√£o n√£o informado."); return; }

  try{
    const d = await jsonp(API + "?idPublico=" + encodeURIComponent(id));

    if(d.erro){
      alert("Cart√£o n√£o localizado: " + d.erro);
      return;
    }

    document.getElementById("nome").textContent = d.nome || "-";
    document.getElementById("cpf").textContent = d.cpf || "-";
    document.getElementById("idPublico").textContent = d.idPublico || id;
    document.getElementById("grupo").textContent = d.grupo || "-";
    document.getElementById("cidade").textContent = d.cidade || "-";  
    document.getElementById("dataCadastro").innerText = formatarDataBR(data.dataAceite);

}



    // ‚úÖ QR: tenta vir da planilha (se algum dia vier), sen√£o gera automaticamente
   // ===============================
// QR CODE (BLOCO √öNICO E SEGURO)
// ===============================
const idPublicoFinal = (d.idPublico || id).trim();

const urlValidar =
  "https://aproveitai.com.br/validar.html?idPublico=" +
  encodeURIComponent(idPublicoFinal);

let qrFinal;

if (d.qrBase64) {
  qrFinal = "data:image/png;base64," + d.qrBase64;
} else if (d.qrURL) {
  qrFinal = d.qrURL;
} else {
  qrFinal =
    "https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=" +
    encodeURIComponent(urlValidar);
}

document.getElementById("qrCode").src = qrFinal;
  }catch(err){
    console.error(err);
    alert("Erro ao carregar dados do cart√£o.");
  }
})();
function formatarDataBR(valor){
  if(!valor) return "-";
  const d = new Date(valor);
  if (isNaN(d)) return valor;
  return d.toLocaleDateString("pt-BR");
}
function voltarPagina() {
  history.back();
}
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
async function salvarPDF() {
  const img = document.getElementById("qrCode");

  if (!img.complete) {
    await new Promise(resolve => {
      img.onload = resolve;
      img.onerror = resolve;
    });
  }

  const elemento = document.getElementById("cartao-print");

  const opt = {
    margin: 5,
    filename: "cartao-aproveitai.pdf",
    image: { type: "jpeg", quality: 0.98 },
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: "mm", format: "a4", orientation: "landscape" }
  };

  html2pdf().set(opt).from(elemento).save();
}
</script>

</body>
</html>
