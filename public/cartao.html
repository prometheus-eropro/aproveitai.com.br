<!DOCTYPE html>
<html lang="pt-BR">
<head>

<meta charset="UTF-8">
<title>Meu Cart√£o | Cart√£o AproveitAI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:system-ui,Arial,sans-serif;background:linear-gradient(135deg,#e7fff0,#d7f8ff);color:#232630}
.brandline{display:grid;grid-template-columns:140px 1fr 140px;gap:12px;align-items:center;justify-items:center;margin:18px auto 0;max-width:900px;padding:0 12px}
.brandline img{height:190px;object-fit:contain}
.pill{background:#e9fff1;border:1px solid #b7efc2;color:#0a4c1a;border-radius:999px;padding:10px 18px;font-weight:900;font-size:1.6rem;text-align:center}
.wrap{max-width:900px;margin:auto;padding:16px}
.card{background:#fff;border-radius:14px;box-shadow:0 6px 22px #0001;padding:18px;margin:18px auto}
.box{border-radius:14px;padding:16px;border:2px dashed #b8c2cc;background:#f7fbff;display:grid;grid-template-columns:1fr 220px;gap:16px;align-items:center}
.box.ativo{background:#e9fbe9;border-color:#1e8e3e}
.box.inativo{background:#fdeaea;border-color:#d93025}
h2{margin:0 0 8px;color:#0a4c1a}
.kv{line-height:1.65}
.kv b{display:inline-block;min-width:110px}
.qr{display:flex;flex-direction:column;align-items:center;gap:10px}
.qr img{width:180px;height:180px;border-radius:12px;border:1px solid #e5eaee;background:#fff}
.actions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:16px}
.btn{background:#0a7f2e;color:#fff;border:none;border-radius:10px;padding:12px 16px;font-weight:800;cursor:pointer;min-width:220px}
.btn2{background:#0a7f2e}
.small{font-size:.9rem;color:#333;text-align:center;margin-top:10px}
@media(max-width:820px){ .box{grid-template-columns:1fr} }
</style>
<link rel="stylesheet" href="style.css">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#0a7f2e">

</head>

<body>


<!-- ‚úÖ CABE√áALHO PADR√ÉO -->
<header class="site-header">
  <div class="brandline">
    <img src="logo-prometheus.png" class="logo logo-prometheus">
    <div class="brand-center">
      <h1 class="site-title">Cart√£o AproveitAI</h1>
      <p class="slogan">Tecnologia com Consci√™ncIA gera Resultado.</p>
      <p class="boas-vindas"><strong>üì£ Meu Cart√£o Digital</strong></p>
    </div>
    <img src="logo-aproveitai.png" class="logo logo-aproveitai">
  </div>

  <div class="tarja-verdeagua">
    
  </div>
</header>

<div class="wrap">
  <div class="card">
    <div id="status" class="small">Carregando dados do cart√£o...</div>

    <div id="cartaoBox" class="box" style="display:none">
      <div class="kv">
        <h2>Valida√ß√£o</h2>
        <div class="small" style="text-align:left;margin:0 0 10px">
          Apresente este cart√£o junto com documento oficial com foto.
        </div>

        <div><b>Nome:</b> <span id="nome">-</span></div>
        <div><b>CPF:</b> <span id="cpf">-</span></div>
        <div><b>ID P√∫blico:</b> <span id="idPublico">-</span></div>
        <div><b>Grupo:</b> <span id="grupo">-</span></div>
        <div><b>Cidade:</b> <span id="cidade">-</span></div>
        <div><b>Cadastro:</b> <span id="dataCadastro">-</span></div>
        <div><b>Status:</b> <span id="statusCliente">-</span></div>

        <div class="small" style="text-align:left;margin-top:10px">
          Suporte: (28) 99969-2303 ‚Ä¢ Email: cartao.aproveitai@gmail.com ‚Ä¢ www.aproveitai.com.br
        </div>
      </div>

      <div class="qr">
        <div style="font-weight:900;color:#0a4c1a">QR Code</div>
        <img id="qrImg" alt="QR Code">
        <div class="small" id="qrHint">Aponte a c√¢mera para validar.</div>
      </div>
    </div>

    <div class="actions">
  <button class="btn" onclick="window.print()">üñ®Ô∏è Imprimir / Salvar Cart√£o</button>
  <button class="btn" onclick="salvarComoImagem()">üíæ Salvar no celular</button>
  <button class="btn btn2" onclick="voltar()">‚¨Ö Voltar ao site</button>
</div>
</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzhwXhtWdsDSuABRneoz6QAD1SxpnMq3vc8e1FhtknlB7_1j6qLjYIbPA0qPJS7ck7y/exec";

function norm(v){ return String(v ?? "").toLowerCase().trim(); }
function isAtivo(v){
  const s = norm(v);
  return ["sim","true","1","ativo","yes"].includes(s);
}

function voltar(){
  window.location.href = "index.html";
}

function qs(name){
  return new URLSearchParams(window.location.search).get(name) || "";
}

(async function carregar(){
  const id = qs("id");
  const elStatus = document.getElementById("status");
  const box = document.getElementById("cartaoBox");

  if(!id){
    elStatus.textContent = "ID do cart√£o n√£o informado.";
    return;
  }

  try{
    // tenta buscar direto por idPublico
    const res = await fetch(`${API_URL}?aba=clientes&idPublico=${encodeURIComponent(id)}`);
    const data = await res.json();

    let c = null;
    if(Array.isArray(data)){
      c = data.find(x => String(x.idPublico).trim() === id);
    }else{
      c = data;
    }

    if(!c || !c.cpf){
      elStatus.textContent = "Dados do cart√£o n√£o encontrados.";
      return;
    }

    const ativo = isAtivo(c.ativo);
    box.classList.add(ativo ? "ativo" : "inativo");

    document.getElementById("nome").textContent = c.nome || "-";
    document.getElementById("cpf").textContent = c.cpf || "-";
    document.getElementById("idPublico").textContent = c.idPublico || id;
    document.getElementById("grupo").textContent = c.grupo || "-";
    document.getElementById("cidade").textContent = c.cidade || "-";
    document.getElementById("dataCadastro").textContent =
  c.dataAceite || c.dataCadastro || "-";
    document.getElementById("statusCliente").textContent = ativo ? "ATIVO" : "INATIVO";

    // QR aponta para validar (se voc√™ tiver validar.html). Se n√£o tiver, ele abre o pr√≥prio cart√£o.
    const urlValidacao = (window.location.origin + "/validar.html?id=" + encodeURIComponent(c.idPublico || id));
    const urlFallback = (window.location.origin + "/cartao.html?id=" + encodeURIComponent(c.idPublico || id));
    const finalUrl = urlValidacao; // troque para urlFallback se ainda n√£o existir validar.html

    document.getElementById("qrImg").src =
      "https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=" + encodeURIComponent(finalUrl);

    elStatus.style.display = "none";
    box.style.display = "grid";
  }catch(e){
    console.error(e);
    elStatus.textContent = "Erro ao carregar os dados do cart√£o.";
  }
})();
</script>

<!-- Lib para capturar imagem -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
function salvarComoImagem(){
  html2canvas(document.querySelector(".card")).then(canvas => {
    const link = document.createElement("a");
    link.download = "cartao-aproveitai.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/sw.js");
}
</script>
<!-- ‚úÖ RODAP√â PADR√ÉO -->
<footer class="footer">
  <div class="footer-container">
    <div>
      <h3>Cart√£o AproveitAI</h3>
      PROMETHEUS EROPRO Solu√ß√µes Inteligentes LTDA<br>
      CNPJ: 58.584.332/0001-40<br>
      üìß cartao.aproveitai@gmail.com<br>
      üìû (28) 99969-2303<br>
      üì∏ @cartao.aproveitai
    </div>
    <div>
      <h3>Links R√°pidos</h3>
      <a href="faq.html">D√∫vidas Frequentes</a><br>
      <a href="privacidade.html">Pol√≠tica de Privacidade</a><br>
      <a href="cookies.html">Pol√≠tica de Cookies</a><br>
      <a href="consentimento.html">Termo de Consentimento</a><br>
      <a href="termos.html">Termos de Uso</a><br>
      <a href="excluir.html">Excluir meus dados</a>
    </div>
  </div>
  <div class="footer-bottom">
    ¬© 2025 AproveitAI. Todos os direitos reservados.
  </div>
</footer>

</body>
</html>
