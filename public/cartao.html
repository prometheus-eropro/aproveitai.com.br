<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Meu Cart√£o | Plataforma AproveitAI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#bfefff;
}

/* =========================
   CABE√áALHO
========================= */
.site-header {
  background: white;
  padding: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.brandline {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 15px;
  flex-wrap: wrap;
}

.logo {
  max-height: 180px;
  height: auto;
  width: auto;
  object-fit: contain;
}

.brand-center {
  flex: 1;
  text-align: center;
}

.site-title {
  font-size: 36px;
  color: #0a7a2a;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
  font-weight: bold;
}

.slogan {
  font-size: 16px;
  font-style: italic;
  margin-bottom: 5px;
  color: #555;
}

.boas-vindas {
  background: #dfffe0;
  padding: 12px 15px;
  border-radius: 8px;
  margin-top: 10px;
  font-size: 18px; /* AUMENTADO */
  line-height: 1.5;
  font-weight: 600;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}
/* =========================
   RODAP√â
========================= */
.footer {
  background: #dfffe0;
  color: #222;
  padding: 10px 10px;
  font-size: 13px;
  border-top: 3px solid white;
}

.footer-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: flex-start;
  gap: 10px;
  max-width: 1000px;
  margin: auto;
  padding: 5px 0;
}

.footer a {
  color: #0066cc;
  font-size: 13px;
}

.footer-bottom {
  text-align: center;
  margin-top: 5px;
  font-size: 11px;
}


/* ================= CART√ÉO (ESTILO FINANCEIRO) ================= */

.cartao-wrapper{
  max-width:420px;
  margin:24px auto;
  padding:16px;
}

.cartao-digital{
  background:#ffffff;
  border-radius:18px;
  box-shadow:0 8px 24px rgba(0,0,0,0.12);
  padding:18px;
}

.cartao-topo{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:14px;
}
.cartao-topo img{
  height:160px;
  max-width:180px;
}
}

.status{
  font-size:12px;
  font-weight:700;
  padding:4px 10px;
  border-radius:20px;
  background:#e6f9ee;
  color:#0a7a3c;
}

.dados-cartao p{
  margin:6px 0;
  font-size:14px;
}

.dados-cartao b{
  color:#0a7a2a;
}

.qr-container{
  margin-top:18px;
  padding:14px;
  background:#f6fff9;
  border-radius:14px;
  text-align:center;
}

.qr-container img{
  width:180px;
  max-width:100%;
}

.qr-container h4{
  margin:6px 0 10px;
  color:#0a7a2a;
}

.aviso{
  font-size:12px;
  margin-top:8px;
}

.suporte{
  margin-top:10px;
  font-size:11px;
  color:#555;
}

/* ================= IMPRESS√ÉO ================= */
@media print{
  body{background:#fff;}
  .botoes,.site-header,.footer{display:none;}
  .cartao-wrapper{max-width:100%;}
}
.acoes-cartao{
  max-width:420px;
  margin:20px auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.acoes-cartao button{
  width:100%;
  padding:12px;
  border-radius:10px;
  font-size:15px;
  background:#1c8f3c;
  color:#fff;
  border:none;
  cursor:pointer;
}

.acoes-cartao .voltar{
  background:#005bb5;
}

</style>
</head>

<body>

<!-- ‚úÖ CABE√áALHO PADRONIZADO -->
<header class="site-header">
  <div class="brandline">
    <img src="logo-prometheus.png" class="logo logo-prometheus">
    <div class="brand-center">
      <h1 class="site-title">Plataforma AproveitAI</h1>
      <p class="slogan">Tecnologia com Consci√™ncIA gera Resultado.</p>

      <!-- Tarja -->
      <p class="boas-vindas">
        üè™ <strong>CART√ÉO DIGITAL</strong><br>
        SALVE, IMPRIMA aproveite os beneficios.
      </p>
    </div>
    <img src="logo-aproveitai.png" class="logo logo-aproveitai">
  </div>
</header>
<div style="
  background:#fff3cd;
  color:#856404;
  padding:8px;
  text-align:center;
  font-size:13px;
">
  ‚ö†Ô∏è Descontos sujeitos √† valida√ß√£o no sistema e √†s regras do parceiro.
</div>

<!-- CART√ÉO -->

<div class="cartao-wrapper" id="cartao-print">

  <div class="cartao-digital">

    <div class="cartao-topo">
      <img src="logo-aproveitai.png">
      
    </div>

    <div class="dados-cartao">
      <p><b>Nome:</b> <span id="nome">-</span></p>
      <p><b>CPF:</b> <span id="cpf">-</span></p>
      <p><b>ID P√∫blico:</b> <span id="idPublico">-</span></p>
      <p><b>Grupo:</b> <span id="grupo">-</span></p>
      <p><b>Cidade:</b> <span id="cidade">-</span></p>
      <p><b>Cadastro:</b> <span id="cadastro">-</span></p>
    </div>

    <div class="qr-container">
      <h4>Valida√ß√£o</h4>
      <img id="qrCode" />
      <div class="aviso">
        Apresente documento com foto se solicitado.<br>
        <strong>Valide sempre antes da compra.</strong>
      </div>
      <div class="suporte">
        SUPORTE ‚Äì (28) 99969-2303<br>
        cartao.aproveitai@gmail.com<br>
        www.aproveitai.com.br
      </div>
    </div>

  </div>

</div>
<!-- BOT√ïES -->
<div class="acoes-cartao">
  <button onclick="salvarCartao()">üíæ Salvar no celular</button>
  <button onclick="window.print()">üñ®Ô∏è Imprimir cart√£o</button>
  <button class="voltar" onclick="history.back()">‚¨Ö Voltar</button>
</div>
<!-- ‚úÖ RODAP√â PADR√ÉO -->
<footer style="
  background:#dfffe0;
  padding:12px;
  text-align:center;
  font-size:12px;
  line-height:1.4;
">
  ¬© 2025 Plataforma AproveitAI ‚Ä¢ PROMETHEUS EROPRO<br>

  <strong>Aviso legal:</strong> A Plataforma AproveitAI n√£o garante descontos.
  Benef√≠cios e promo√ß√µes s√£o definidos e concedidos exclusivamente pelos parceiros,
  v√°lidos, em regra, para pagamentos √† vista em meda corrente, salvo autoriza√ß√£o expressa do estabelecimento.
</footer>

<!-- ================= SCRIPT ================= -->
<!-- html2canvas PRIMEIRO -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script>
const API = "https://script.google.com/macros/s/AKfycbzhwXhtWdsDSuABRneoz6QAD1SxpnMq3vc8e1FhtknlB7_1j6qLjYIbPA0qPJS7ck7y/exec";
const id = new URLSearchParams(location.search).get("id");


function jsonp(url){
  return new Promise((resolve, reject) => {
    const cb = "cb_" + Math.random().toString(36).slice(2);
    window[cb] = (data) => { resolve(data); cleanup(); };
    const s = document.createElement("script");
    s.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cb;
    s.onerror = () => { reject(new Error("JSONP_FAIL")); cleanup(); };
    document.body.appendChild(s);
    function cleanup(){
      try{ delete window[cb]; }catch(e){ window[cb]=undefined; }
      if(s && s.parentNode) s.parentNode.removeChild(s);
    }
  });
}

(async () => {
  if(!id){ alert("ID do cart√£o n√£o informado."); return; }

  try{
    const d = await jsonp(API + "?idPublico=" + encodeURIComponent(id));

    if(d.erro){
      alert("Cart√£o n√£o localizado: " + d.erro);
      return;
    }

    document.getElementById("nome").textContent = d.nome || "-";
    document.getElementById("cpf").textContent = d.cpf || "-";
    document.getElementById("idPublico").textContent = d.idPublico || id;
    document.getElementById("grupo").textContent = d.grupo || "-";
    document.getElementById("cidade").textContent = d.cidade || "-";
document.getElementById("cadastro").textContent =
  formatarDataBR(d.dataCadastro);



    const idFinal = (d.idPublico || id).trim();
    const urlValidar = "https://aproveitai.com.br/validar.html?idPublico=" + encodeURIComponent(idFinal);

    document.getElementById("qrCode").src =
      d.qrURL ||
      "https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=" +
      encodeURIComponent(urlValidar);

  }catch(err){
    console.error(err);
    alert("Erro ao carregar dados do cart√£o.");
  }
})();

function salvarCartao() {
  const cartao = document.getElementById("cartao-print");
  const qr = document.getElementById("qrCode");

  if (!qr || !qr.complete) {
    alert("Aguarde o QR Code carregar.");
    return;
  }

  html2canvas(cartao, { scale: 2, useCORS: true }).then(canvas => {
    const link = document.createElement("a");
    link.download = "cartao-aproveitai.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });
}

function voltarPagina() {
  history.back();
}

function formatarDataBR(data) {
  if (!data) return "-";
  const d = new Date(data);
  if (isNaN(d)) return data;
  return d.toLocaleDateString("pt-BR");
}
</script>

</body>
</html>
