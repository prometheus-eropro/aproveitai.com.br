<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Meu Cart√£o | Cart√£o AproveitAI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#bfefff;
}

/* =========================
   CABE√áALHO
========================= */
.site-header {
  background: white;
  padding: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.brandline {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 15px;
  flex-wrap: wrap;
}

.logo {
  max-height: 180px;
  height: auto;
  width: auto;
  object-fit: contain;
}

.brand-center {
  flex: 1;
  text-align: center;
}

.site-title {
  font-size: 36px;
  color: #0a7a2a;
  text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
  font-weight: bold;
}

.slogan {
  font-size: 16px;
  font-style: italic;
  margin-bottom: 5px;
  color: #555;
}

.boas-vindas {
  background: #dfffe0;
  padding: 12px 15px;
  border-radius: 8px;
  margin-top: 10px;
  font-size: 18px; /* AUMENTADO */
  line-height: 1.5;
  font-weight: 600;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}

/* ================= CART√ÉO ================= */
.cartao-dobravel{
  display:flex;
  width:17.2cm;
  min-height:5.4cm;
  margin:25px auto;
  background:#f0fff0;
  border:2px dashed #1c8f3c;
  border-radius:10px;
  overflow:hidden;
}
.cartao-lado{
  width:50%;
  padding:10px;
  box-sizing:border-box;
}
.cartao-esquerdo img{
  width:80px;
}
.dados-cartao p{
  margin:4px 0;
  font-size:13px;
}
.dados-cartao b{
  color:#0a7a2a;
  min-width:120px;
  display:inline-block;
}
.linha-dobra{
  width:1px;
  background:#1c8f3c;
}
.cartao-direito{
  text-align:center;
}
.qr-img{
  width:90px;
  height:90px;
  margin:8px auto;
}
.aviso{
  font-size:10px;
}
.atencao{
  color:#b80000;
  font-weight:bold;
}
.suporte{
  font-size:9px;
}

/* ================= BOT√ïES ================= */
.botoes{
  text-align:center;
  margin:20px 0;
}
.botoes button{
  background:#1c8f3c;
  color:#fff;
  border:none;
  padding:10px 22px;
  margin:6px;
  border-radius:8px;
  font-size:15px;
  cursor:pointer;
}
.botoes button.voltar{
  background:#005bb5;
}

/* =========================
   RODAP√â
========================= */
.footer {
  background: #dfffe0;
  color: #222;
  padding: 10px 10px;
  font-size: 13px;
  border-top: 3px solid white;
}

.footer-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: flex-start;
  gap: 10px;
  max-width: 1000px;
  margin: auto;
  padding: 5px 0;
}

.footer a {
  color: #0066cc;
  font-size: 13px;
}

.footer-bottom {
  text-align: center;
  margin-top: 5px;
  font-size: 11px;
}

/* ================= IMPRESS√ÉO ================= */
@media print{
  body{background:#fff;}
  .botoes,.site-header,.footer{display:none;}
}

</style>
</head>

<body>

<!-- ‚úÖ CABE√áALHO PADRONIZADO -->
<header class="site-header">
  <div class="brandline">
    <img src="logo-prometheus.png" class="logo logo-prometheus">
    <div class="brand-center">
      <h1 class="site-title">Cart√£o AproveitAI</h1>
      <p class="slogan">Tecnologia com Consci√™ncIA gera Resultado.</p>

      <!-- Tarja -->
      <p class="boas-vindas">
        üè™ <strong>√Årea do Parceiro</strong><br>
        Valide clientes e acompanhe seus relat√≥rios.
      </p>
    </div>
    <img src="logo-aproveitai.png" class="logo logo-aproveitai">
  </div>
</header>
<div style="
  background:#fff3cd;
  color:#856404;
  padding:8px;
  text-align:center;
  font-size:13px;
">
  ‚ö†Ô∏è Descontos sujeitos √† valida√ß√£o no sistema e √†s regras do parceiro.
</div>

<!-- CART√ÉO -->

<div class="cartao-dobravel" id="cartao-print">

  <div class="cartao-lado cartao-esquerdo">
    <img src="logo-aproveitai.png">
    <div class="dados-cartao">
      <p><b>Nome:</b> <span id="nome">-</span></p>
      <p><b>CPF:</b> <span id="cpf">-</span></p>
      <p><b>ID P√∫blico:</b> <span id="idPublico">-</span></p>
      <p><b>Grupo:</b> <span id="grupo">-</span></p>
      <p><b>Cidade:</b> <span id="cidade">-</span></p>
      <p><b>Cadastro:</b> <span id="cadastro">-</span></p>
    </div>
  </div>

  <div class="linha-dobra"></div>

  <div class="cartao-lado cartao-direito">
    <h4>Valida√ß√£o</h4>
    <img id="qrCode" class="qr-img">
    <div class="aviso">
      Apresente documento com foto se solicitado.<br>
      <span class="atencao">Valide sempre antes da compra.</span>
    </div>
    <div class="suporte">
      (28) 99969-2303<br>
      cartao.aproveitai@gmail.com<br>
      www.aproveitai.com.br
    </div>
  </div>

</div>

<!-- BOT√ïES -->
<div class="botoes">
 <button onclick="salvarCartao()">üíæ Salvar no celular</button>
 <button onclick="window.print()">üñ®Ô∏è Imprimir cart√£o</button>
  <button class="voltar" onclick="history.back()">‚¨Ö Voltar</button>
</div>

<!-- ‚úÖ RODAP√â PADR√ÉO -->
<footer style="
  background:#dfffe0;
  padding:12px;
  text-align:center;
  font-size:12px;
  line-height:1.4;
">
  ¬© 2025 Cart√£o AproveitAI ‚Ä¢ PROMETHEUS EROPRO<br>

  <strong>Aviso legal:</strong> O Cart√£o AproveitAI n√£o garante descontos.
  Benef√≠cios e promo√ß√µes s√£o definidos e concedidos exclusivamente pelos parceiros,
  v√°lidos, em regra, para pagamentos √† vista, salvo autoriza√ß√£o expressa do estabelecimento.
</footer>

<!-- ================= SCRIPT ================= -->
<script>
const API = "https://script.google.com/macros/s/AKfycbzhwXhtWdsDSuABRneoz6QAD1SxpnMq3vc8e1FhtknlB7_1j6qLjYIbPA0qPJS7ck7y/exec";
const id = new URLSearchParams(location.search).get("id");

function jsonp(url){
  return new Promise((resolve, reject) => {
    const cb = "cb_" + Math.random().toString(36).slice(2);
    window[cb] = (data) => { resolve(data); cleanup(); };
    const s = document.createElement("script");
    s.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cb;
    s.onerror = () => { reject(new Error("JSONP_FAIL")); cleanup(); };
    document.body.appendChild(s);
    function cleanup(){
      try{ delete window[cb]; }catch(e){ window[cb]=undefined; }
      if(s && s.parentNode) s.parentNode.removeChild(s);
    }
  });
}

(async () => {
  if(!id){ alert("ID do cart√£o n√£o informado."); return; }

  try{
    const d = await jsonp(API + "?idPublico=" + encodeURIComponent(id));

    if(d.erro){
      alert("Cart√£o n√£o localizado: " + d.erro);
      return;
    }

    document.getElementById("nome").textContent = d.nome || "-";
    document.getElementById("cpf").textContent = d.cpf || "-";
    document.getElementById("idPublico").textContent = d.idPublico || id;
    document.getElementById("grupo").textContent = d.grupo || "-";
    document.getElementById("cidade").textContent = d.cidade || "-";
    document.getElementById("cadastro").textContent = d.dataCadastro || "-";

    // ‚úÖ QR: tenta vir da planilha (se algum dia vier), sen√£o gera automaticamente
    const idPub = (d.idPublico || id).trim();
    const urlValidar1 = "https://aproveitai.com.br/validar.html?id=" + encodeURIComponent(idPub); // padr√£o recomendado
// ‚úÖ QR Code: prioridade -> Base64 | URL da planilha | Gerado na hora
const idPub = (d.idPublico || id).trim();
const urlValidar = "https://aproveitai.com.br/validar.html?idPublico=" + encodeURIComponent(idPub);

let qrFinal = "";

// 1Ô∏è‚É£ Se um dia voc√™ salvar base64 no GS
if (d.qrBase64) {
  qrFinal = "data:image/png;base64," + d.qrBase64;

// 2Ô∏è‚É£ Se existir URL pronta na planilha
} else if (d.qrURL) {
  qrFinal = d.qrURL;

// 3Ô∏è‚É£ Fallback autom√°tico (GARANTE funcionamento)
} else {
  qrFinal =
    "https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=" +
    encodeURIComponent(urlValidar);
}

// ‚úÖ AQUI ESTAVA FALTANDO
document.getElementById("qrCode").src = qrFinal;
  }catch(err){
    console.error(err);
    alert("Erro ao carregar dados do cart√£o.");
  }
})();
</script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>

function salvarCartao() {
  const cartao = document.getElementById("cartao-print");

  html2canvas(cartao, {
    scale: 2,
    useCORS: false
  }).then(canvas => {
    const link = document.createElement("a");
    link.download = "cartao-aproveitai.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });
}

function formatarDataBR(iso){
  if(!iso) return "-";
  const d = new Date(iso);
  return d.toLocaleDateString("pt-BR") + " " +
         d.toLocaleTimeString("pt-BR", {hour:"2-digit", minute:"2-digit"});
}

</script>
</body>
</html>
