<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>√Årea do Cliente | Cart√£o AproveitAI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">


</head>

<body>
<!-- ‚úÖ CABE√áALHO COM TARJA PADR√ÉO -->
<header class="site-header">
  <div class="brandline">
    <img src="logo-prometheus.png" class="logo logo-prometheus">
    <div class="brand-center">
      <h1 class="site-title">Cart√£o AproveitAI</h1>
      <p class="slogan">Tecnologia com Consci√™ncIA gera Resultado.</p>

      <!-- Tarja com nome da p√°gina -->
      <p class="boas-vindas">
        üë§ <strong>√Årea do Cliente</strong><br>
        Consulte seu CPF ou ID e acesse benef√≠cios e promo√ß√¥es exclusivas.
      </p>
    </div>
    <img src="logo-aproveitai.png" class="logo logo-aproveitai">
  </div>
</header>

<div class="wrap">
  <div class="card">
    <h2 style="text-align:center;margin:0 0 10px;color:#0a4c1a">
      Bem-vindo √† √Årea do Cliente
    </h2>
<p id="bemVindoNome" style="text-align:center;font-weight:600;color:#0a7f2e"></p>

    <input id="cpf" placeholder="Digite seu CPF ou ID P√∫blico (APV-XXXX)">

    <button onclick="consultar()">Consultar</button>

    <div class="small">
      Ap√≥s a consulta, voc√™ poder√° acessar seu cart√£o digital,
      salvar no celular ou imprimir.
    </div>

    <div id="resultado"></div>

    <button
      id="btnBeneficios"
      class="btn2"
      style="display:none;margin-top:15px"
      onclick="abrirBeneficios()">
      üéÅ Ver Benef√≠cios e Promo√ß√µes
    </button>

    <button
      id="btnCartao"
      class="btn2"
      style="display:none;margin-top:10px"
      onclick="abrirCartao()">
      üí≥ Ver / Salvar Cart√£o
    </button>
<div style="text-align:center;margin-top:15px">
  <a href="index.html" class="voltar">
    ‚Üê Voltar ao site
  </a>
</div>

  </div>
</div>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzhwXhtWdsDSuABRneoz6QAD1SxpnMq3vc8e1FhtknlB7_1j6qLjYIbPA0qPJS7ck7y/exec"; // mant√©m a sua

function getCampo(obj, chaves){
  for (const k of chaves){
    if (obj && obj[k] !== undefined && obj[k] !== null && String(obj[k]).trim() !== "") return obj[k];
  }
  return "";
}

function formatarDataBR(valor){
  if (!valor) return "-";

  // j√° vem como "03/01/2026 10:41:35"
  if (typeof valor === "string" && valor.includes("/") && valor.includes(":")) return valor;

  // ISO / timestamp
  const d = new Date(valor);
  if (!isNaN(d.getTime())){
    const dd = String(d.getDate()).padStart(2,"0");
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const aa = d.getFullYear();
    const hh = String(d.getHours()).padStart(2,"0");
    const mi = String(d.getMinutes()).padStart(2,"0");
    return `${dd}/${mm}/${aa} ${hh}:${mi}`;
  }

  return String(valor);
}

function isAtivo(valor){
  const v = String(valor || "").toUpperCase().trim();
  return (v === "SIM" || v === "ATIVO" || v === "TRUE" || v === "1");
}

async function consultarCliente(){
  const input = document.getElementById("cpfOuId");
  const resultado = document.getElementById("resultado");
  const btnBeneficios = document.getElementById("btnBeneficios");
  const btnCartao = document.getElementById("btnCartao");

  const termo = (input.value || "").trim();
  if (!termo){
    resultado.innerHTML = "<p style='color:#b00020;font-weight:800'>Digite seu CPF ou ID P√∫blico.</p>";
    btnBeneficios.style.display = "none";
    btnCartao.style.display = "none";
    return;
  }

  resultado.innerHTML = "<p>Consultando...</p>";

  try{
    // usa JSONP se seu Apps Script estiver em JSONP (callback)
    const url = `${API_URL}?consulta=1&termo=${encodeURIComponent(termo)}&callback=cb_${Date.now()}`;
    const data = await jsonp(url);

    if (!data || !data.encontrado){
      resultado.innerHTML = "<p style='color:#b00020;font-weight:800'>Cliente n√£o encontrado.</p>";
      btnBeneficios.style.display = "none";
      btnCartao.style.display = "none";
      return;
    }

    const achado = data.dados || {};

    const nome = getCampo(achado, ["nome"]);
    const cpf = getCampo(achado, ["cpf"]);
    const idPublico = getCampo(achado, ["idPublico","id_publico","id"]);
    const grupo = getCampo(achado, ["grupo"]);
    const cidade = getCampo(achado, ["cidade"]);
    const celular = getCampo(achado, ["celular","telefone","tel"]);
    const nascimento = getCampo(achado, ["nascimento","dataNascimento","data_nascimento"]);
    const dataAceite = getCampo(achado, ["dataAceite","dataCadastro","cadastro","data_aceite"]);
    const ativo = getCampo(achado, ["ativo","status"]);

    const ativoBool = isAtivo(ativo);

    resultado.innerHTML = `
      <div class="result-box">
        <div><b>Nome:</b> ${nome || "-"}</div>
        <div><b>CPF:</b> ${cpf || "-"}</div>
        <div><b>ID P√∫blico:</b> ${idPublico || "-"}</div>
        <div><b>Grupo:</b> ${grupo || "-"}</div>
        <div><b>Cidade:</b> ${cidade || "-"}</div>
        <div><b>Celular:</b> ${celular || "-"}</div>
        <div><b>Data de Nascimento:</b> ${nascimento || "-"}</div>
        <div><b>Data de Cadastro/Aceite:</b> ${formatarDataBR(dataAceite)}</div>
        <div class="status-pill ${ativoBool ? "status-ativo" : "status-inativo"}">
          ${ativoBool ? "ATIVO" : "INATIVO"}
        </div>
      </div>
    `;

    // guarda ID para outras p√°ginas
    if (idPublico) localStorage.setItem("ultimoIdPublico", idPublico);

    // s√≥ libera bot√µes se ATIVO
    btnBeneficios.style.display = ativoBool ? "block" : "none";
    btnCartao.style.display = ativoBool ? "block" : "none";

  }catch(err){
    console.error(err);
    resultado.innerHTML = "<p style='color:#b00020;font-weight:800'>Erro ao consultar. Verifique a API.</p>";
    btnBeneficios.style.display = "none";
    btnCartao.style.display = "none";
  }
}

// JSONP helper
function jsonp(url){
  return new Promise((resolve, reject) => {
    const cbName = "cb_" + Math.random().toString(36).slice(2);
    const s = document.createElement("script");
    const timeout = setTimeout(() => {
      cleanup();
      reject(new Error("Timeout JSONP"));
    }, 12000);

    function cleanup(){
      clearTimeout(timeout);
      if (s.parentNode) s.parentNode.removeChild(s);
      delete window[cbName];
    }

    window[cbName] = (payload) => {
      cleanup();
      resolve(payload);
    };

    s.src = url.replace(/callback=[^&]+/, "callback=" + cbName);
    s.onerror = () => { cleanup(); reject(new Error("Erro ao carregar JSONP")); };
    document.body.appendChild(s);
  });
}

// liga bot√£o
document.getElementById("btnConsultar").addEventListener("click", consultarCliente);
</script>

<!-- ‚úÖ RODAP√â PADR√ÉO -->
<footer style="
  background:#dfffe0;
  padding:10px;
  text-align:center;
  font-size:12px;
">
  ¬© 2025 Cart√£o AproveitAI ‚Ä¢ PROMETHEUS EROPRO
</footer>


</body>
</html>
