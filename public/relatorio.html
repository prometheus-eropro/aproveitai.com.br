<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Relat√≥rio de Consultas</title>
<style>
  body { font-family: Arial; padding: 20px; }
  table { width: 100%; border-collapse: collapse; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #2e7d32; color: #fff; }
</style>
</head>
<body>
<!-- ‚úÖ CABE√áALHO PADRONIZADO -->
<header class="site-header">
  <div class="brandline">
    <img src="logo-prometheus.png" class="logo logo-prometheus">
    <div class="brand-center">
      <h1 class="site-title">Cart√£o AproveitAI</h1>
      <p class="slogan">Tecnologia com Consci√™ncIA gera Resultado.</p>

      <!-- Tarja -->
      <p class="boas-vindas">
        üè™ <strong>√Årea do Parceiro</strong><br>
        Valide clientes e acompanhe seus relat√≥rios.
      </p>
    </div>
    <img src="logo-aproveitai.png" class="logo logo-aproveitai">
  </div>
<link rel="stylesheet" href="style.css">

</header>

<h2 id="tituloRelatorio">Relat√≥rio de Consultas</h2>
<div id="periodoRelatorio" style="
  margin:8px 0 15px 0;
  font-size:14px;
  font-weight:bold;
  color:#2e7d32;
"></div>

<div id="dadosParceiro" class="dados-parceiro"></div>


<button class="relatorio-botao" onclick="window.print()">
  üñ®Ô∏è Imprimir / PDF
</button>
<div style="text-align:center;margin:15px 0;">

  </a>
</div>


<table>
<thead>
<tr>
  <th>Data/Hora</th>
  <th>Grupo</th>
  <th>Status</th>
  <th>C√≥digo de Autoriza√ß√£o</th>
</tr>
</thead>
<tbody id="dados"></tbody>
</table>

<script>
/* =========================
   CONFIGURA√á√ÉO
========================= */
const API_URL = "https://script.google.com/macros/s/AKfycbzhwXhtWdsDSuABRneoz6QAD1SxpnMq3vc8e1FhtknlB7_1j6qLjYIbPA0qPJS7ck7y/exec";

/* =========================
   SESS√ÉO DO PARCEIRO
========================= */
const parceiroNome = localStorage.getItem("parceiroNome");
const parceiroCNPJ = localStorage.getItem("parceiroCNPJ");
const tokenApp     = localStorage.getItem("parceiroToken");

/* =========================
   PROTE√á√ÉO
========================= */
if (!parceiroNome || !parceiroCNPJ || !tokenApp) {
  document.body.innerHTML = `
    <div style="padding:40px;text-align:center">
      <h2>‚ö†Ô∏è Sess√£o n√£o encontrada</h2>
      <p>Fa√ßa login novamente no painel do parceiro.</p>
      <button onclick="location.href='painelparceiro.html'">
        üîê Ir para o Painel
      </button>
    </div>
  `;
  throw new Error("Sess√£o inv√°lida");
}

/* =========================
   EXIBIR DADOS DO PARCEIRO
========================= */
document.getElementById("dadosParceiro").innerHTML = `
  <strong>Parceiro:</strong> ${parceiroNome}<br>
  <strong>CNPJ:</strong> ${parceiroCNPJ}
`;

/* =========================
   CARREGAR RELAT√ìRIO
========================= */
fetch(
  API_URL +
  "?relatorio=1" +
  "&parceiro=" + encodeURIComponent(parceiroNome)
)
.then(r => r.json())
.then(resp => {
  const tbody = document.getElementById("dados");
  tbody.innerHTML = "";

  if (!resp.ok || !Array.isArray(resp.dados) || resp.dados.length === 0) {
    tbody.innerHTML =
      "<tr><td colspan='4'>Nenhum registro encontrado.</td></tr>";
    return;
  }

  document.getElementById("periodoRelatorio").innerText =
    "Relat√≥rio padr√£o (√∫ltimos registros)";

  resp.dados.forEach(l => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${l.data || "-"}</td>
      <td>${l.grupo || "-"}</td>
      <td>${l.status || "-"}</td>
      <td>${l.codigoERO || "-"}</td>
    `;
    tbody.appendChild(tr);
  });
})
.catch(() => {
  document.getElementById("dados").innerHTML =
    "<tr><td colspan='4'>Erro ao carregar relat√≥rio.</td></tr>";
});
</script>

<!-- ‚úÖ RODAP√â PADR√ÉO -->
<footer style="
  background:#dfffe0;
  padding:12px;
  text-align:center;
  font-size:12px;
  line-height:1.4;
">
  ¬© 2025 Cart√£o AproveitAI ‚Ä¢ PROMETHEUS EROPRO<br>

  <strong>Aviso legal:</strong> O Cart√£o AproveitAI n√£o garante descontos.
  Benef√≠cios e promo√ß√µes s√£o definidos e concedidos exclusivamente pelos parceiros,
  v√°lidos, em regra, para pagamentos √† vista, salvo autoriza√ß√£o expressa do estabelecimento.
</footer>
</body>
</html>
