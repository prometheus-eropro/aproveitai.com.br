<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Valida√ß√£o por QR Code ‚Ä¢ Cart√£o AproveitAI</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background-color: #f8fdf9;
      margin: 0;
      padding: 0;
    }
    header {
      text-align: center;
      padding: 20px;
      background-color: #fff;
      border-bottom: 4px solid #008000;
    }
    h1 {
      color: #008000;
      margin-bottom: 4px;
    }
    h2 {
      font-size: 20px;
      margin-top: 0;
      color: #333;
    }
    #reader {
      width: 320px;
      margin: 30px auto;
      background: #fff;
      border: 2px dashed #008000;
      border-radius: 12px;
      padding: 10px;
    }
    #status {
      text-align: center;
      font-size: 16px;
      margin-top: 20px;
    }
    footer {
      background-color: #e6ffe6;
      text-align: center;
      font-size: 14px;
      padding: 20px 10px;
      margin-top: 50px;
      color: #333;
    }
    a {
      text-decoration: none;
    }
  </style>
</head>

<body>
  <!-- ‚úÖ CABE√áALHO PADRONIZADO -->
<header class="site-header">
  <div class="brandline">
    <img src="logo-prometheus.png" class="logo logo-prometheus">
    <div class="brand-center">
      <h1 class="site-title">Cart√£o AproveitAI</h1>
      <p class="slogan">Tecnologia com Consci√™ncIA gera Resultado.</p>

      <!-- Tarja -->
      <p class="boas-vindas">
        üè™ <strong>√Årea do Parceiro</strong><br>
        VALIDADOR DE QRCODEe.
      </p>
    </div>
    <img src="logo-aproveitai.png" class="logo logo-aproveitai">
  </div>
</header>


  <main id="conteudo-principal" style="text-align:center;">
    <div id="reader"></div>
    <div id="status">Aponte a c√¢mera para o QR Code do cliente.</div>
  </main>

<!-- ‚úÖ RODAP√â PADR√ÉO -->
<footer class="footer">
  <div class="footer-container">
    <div>
      <h3>Cart√£o AproveitAI</h3>
      PROMETHEUS EROPRO Solu√ß√µes Inteligentes LTDA<br>
      CNPJ: 58.584.332/0001-40<br>
      üìß cartao.aproveitai@gmail.com<br>
      üìû (28) 99969-2303<br>
      üì∏ @cartao.aproveitai
    </div>
    <div>
      <h3>Links R√°pidos</h3>
      <a href="faq.html">D√∫vidas Frequentes</a><br>
      <a href="privacidade.html">Pol√≠tica de Privacidade</a><br>
      <a href="cookies.html">Pol√≠tica de Cookies</a><br>
      <a href="consentimento.html">Termo de Consentimento</a><br>
      <a href="termos.html">Termos de Uso</a><br>
      <a href="excluir.html">Excluir meus dados</a>
    </div>
  </div>
  <div class="footer-bottom">
    ¬© 2025 AproveitAI. Todos os direitos reservados.
  </div>
</footer>

  <!-- ========================= BLOQUEIO DE ACESSO ========================= -->
  <script>
  const parceiroLogado = sessionStorage.getItem("parceiroLogado");
  const parceiroNome = sessionStorage.getItem("parceiroNome");

  // Corrigido: aceita qualquer parceiro logado, n√£o apenas "SIM"
if (!parceiroLogado || !parceiroNome) {
  document.getElementById("conteudo-principal").innerHTML = `
    <div style="padding:60px 20px;">
      <h2 style="color:#333;">‚ö†Ô∏è Acesso restrito</h2>
      <p>Este validador s√≥ pode ser acessado pela <b>√Årea do Parceiro</b>.</p>
      <a href="painelparceiro.html" style="color:#008000; font-weight:bold;">Ir para √Årea do Parceiro</a>
    </div>
  `;
  throw new Error("Parceiro n√£o logado");
}

    document.getElementById("conteudo-principal").innerHTML = `
      <div style="padding:60px 20px;">
        <h2 style="color:#333;">‚ö†Ô∏è Acesso restrito</h2>
        <p>Este validador s√≥ pode ser acessado pela <b>√Årea do Parceiro</b>.</p>
        <a href="painelparceiro.html" style="color:#008000; font-weight:bold;">Ir para √Årea do Parceiro</a>
      </div>
    `;
    throw new Error("Parceiro n√£o logado");
  }
  </script>

  <!-- ========================= SCRIPT DE LEITURA QR CODE ========================= -->
  <script>
  const API_URL = "https://script.google.com/macros/s/AKfycbzhwXhtWdsDSuABRneoz6QAD1SxpnMq3vc8e1FhtknlB7_1j6qLjYIbPA0qPJS7ck7y/exec";

  function onScanSuccess(decodedText) {
    const idCliente = decodedText.trim();
    const parceiro = sessionStorage.getItem("parceiroNome") || "total";
    const url = `${API_URL}?idPublico=${encodeURIComponent(idCliente)}&parceiro=${encodeURIComponent(parceiro)}`;

    jsonp(url).then(data => {
      if (!data || !data.nome) {
        document.getElementById("status").innerHTML = "‚ùå Cliente n√£o encontrado.";
        return;
      }
      const ativo = data.ativo === "SIM";
      const cor = ativo ? "#0a7f2e" : "#c00";
      document.getElementById("status").innerHTML = `
        <div style="text-align:left; border:2px solid ${cor}; border-radius:8px; padding:10px; display:inline-block;">
          <b>Nome:</b> ${data.nome}<br>
          <b>CPF:</b> ${data.cpf}<br>
          <b>ID P√∫blico:</b> ${data.idPublico}<br>
          <b>Status:</b> <span style="color:${cor}; font-weight:bold;">${ativo ? "ATIVO" : "INATIVO"}</span><br>
          <b>Parceiro:</b> ${parceiro}<br>
          <b>C√≥digo Autoriza√ß√£o:</b> ${data.codigoERO || "-"}
        </div>`;
    });
  }

  function jsonp(url) {
    return new Promise((resolve, reject) => {
      const cb = "cb_" + Date.now();
      window[cb] = data => {
        resolve(data);
        delete window[cb];
        script.remove();
      };
      const script = document.createElement("script");
      script.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cb;
      script.onerror = reject;
      document.body.appendChild(script);
    });
  }

  function iniciarScanner() {
    const html5QrCode = new Html5Qrcode("reader");
    Html5Qrcode.getCameras().then(cameras => {
      if (cameras.length) {
        html5QrCode.start(cameras[0].id, { fps: 10, qrbox: 250 }, onScanSuccess);
      } else {
        document.getElementById("status").innerHTML = "‚ùå Nenhuma c√¢mera encontrada.";
      }
    }).catch(err => {
      document.getElementById("status").innerHTML = "‚ö†Ô∏è Erro ao acessar a c√¢mera.";
      console.error(err);
    });
  }

  window.addEventListener("load", () => {
    const script = document.createElement("script");
    script.src = "https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js";
    script.onload = iniciarScanner;
    document.body.appendChild(script);
  });
  </script>
</body>
</html>
