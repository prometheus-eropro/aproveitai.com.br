<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Valida√ß√£o de Benef√≠cio | Parceiro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: Arial, sans-serif; background:#eaf6ff; padding:20px; }
  .container { max-width:420px; margin:auto; background:#fff; padding:20px; border-radius:10px; }
  h2 { color:#0a7a3c; text-align:center; }
  label { display:block; margin-top:15px; font-weight:600; }
  input, button { width:100%; padding:10px; margin-top:5px; box-sizing:border-box; }
  button { background:#0a7a3c; color:#fff; border:none; border-radius:6px; margin-top:20px; cursor:pointer; }
  button:disabled { opacity:.6; cursor:not-allowed; }
  .msg { margin-top:15px; font-weight:bold; text-align:center; min-height:20px; }
  .site-header { background:white; padding:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
  .brandline { display:flex; align-items:center; justify-content:space-between; gap:15px; flex-wrap:wrap; }
  .logo { max-height:180px; height:auto; width:auto; object-fit:contain; }
  .brand-center { flex:1; text-align:center; }
  .site-title { font-size:36px; color:#0a7a2a; text-shadow:1px 1px 3px rgba(0,0,0,0.3); font-weight:bold; margin:0; }
  .slogan { font-size:16px; font-style:italic; margin:6px 0 5px; color:#555; }
  .boas-vindas { background:#dfffe0; padding:12px 15px; border-radius:8px; margin-top:10px; font-size:18px; line-height:1.5; font-weight:600; box-shadow:0 1px 3px rgba(0,0,0,0.08); }
  .footer { background:#dfffe0; color:#222; padding:10px; font-size:13px; border-top:3px solid white; text-align:center; }
</style>
</head>

<body>
<header class="site-header">
  <div class="brandline">
    <img src="logo-prometheus.png" class="logo logo-prometheus" alt="Prometheus">
    <div class="brand-center">
      <h1 class="site-title">Plataforma AproveitAI</h1>
      <p class="slogan">Tecnologia com Consci√™ncIA gera Resultado.</p>
      <p class="boas-vindas">
        üè™ <strong>VALIDADOR QR CODE PARCEIRO</strong><br>
        Valide o QR CODE do parceiro, seu cart√£o estando ativo voc√™ receber√° o c√≥digo de autoriza√ß√£o do benef√≠cio.
      </p>
    </div>
    <img src="logo-aproveitai.png" class="logo logo-aproveitai" alt="Aproveitai">
  </div>
</header>

<div style="background:#fff3cd;color:#856404;padding:8px;text-align:center;font-size:13px;">
  ‚ö†Ô∏è Descontos sujeitos √† valida√ß√£o no sistema e √†s regras do parceiro.
</div>

<div class="container">
  <h2>Valida√ß√£o de Benef√≠cio</h2>

  <label>CPF do Cliente</label>
  <input id="cpf" placeholder="Somente n√∫meros" inputmode="numeric">

  <div id="blocoVeiculo" style="display:none">
    <label>Placa do ve√≠culo</label>
    <input id="placa" placeholder="ABC-1234">
  </div>

  <button id="btnValidar" onclick="validar()">Validar</button>
  <div id="msg" class="msg"></div>
</div>

<script>
/* =============================
   CONFIGURA√á√ÉO
============================= */
const GAS_URL = "https://script.google.com/macros/s/AKfycbzHJgHVFPc7jM47MenTIxTD3hPiMJUPjIdeknpU_3GOP3WmV1ubCbaJ7m1jrSU2M4Fksg/exec";

const params = new URLSearchParams(window.location.search);
const parceiroId = params.get("p");

const elMsg = document.getElementById("msg");
const elBtn = document.getElementById("btnValidar");

/* =============================
   UTILIDADES
============================= */
function mostrarMsg(msg) {
  elMsg.innerHTML = msg || "";
}

function somenteNumeros(v) {
  return String(v || "").replace(/\D/g, "");
}

/* =============================
   VALIDA√á√ÉO
============================= */
async function validar() {
  if (!parceiroId) {
    mostrarMsg("‚ùå QR Code inv√°lido. Parceiro n√£o identificado.");
    return;
  }

  const cpf = somenteNumeros(document.getElementById("cpf").value);
  const placaInput = document.getElementById("placa");
  const placa = placaInput ? placaInput.value.trim() : "";

  if (cpf.length !== 11) {
    mostrarMsg("‚ö†Ô∏è Informe um CPF com 11 d√≠gitos.");
    return;
  }

  elBtn.disabled = true;
  mostrarMsg("‚è≥ Validando benef√≠cio...");

  try {
    const resp = await fetch(GAS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        parceiro_id: parceiroId,
        cpf: cpf,
        placa: placa
      })
    });

    const json = await resp.json();
    elBtn.disabled = false;

    if (json.ok || json.status === "AUTORIZADO") {
      mostrarMsg(json.mensagem);
    } else {
      mostrarMsg("‚ùå " + (json.mensagem || "Valida√ß√£o n√£o autorizada."));
    }

  } catch (e) {
    elBtn.disabled = false;
    mostrarMsg("‚ùå Erro de conex√£o com o servidor de valida√ß√£o.");
  }
}

/* =============================
   BLOQUEIO SE QR INV√ÅLIDO
============================= */
if (!parceiroId) {
  mostrarMsg("‚ùå QR Code inv√°lido. Par√¢metro do parceiro n√£o encontrado.");
  elBtn.disabled = true;
}
</script>

<footer class="footer">
  ¬© 2025 Plataforma AproveitAI ‚Ä¢ PROMETHEUS EROPRO<br>
  <strong>Aviso legal:</strong> A Plataforma AproveitAI n√£o garante descontos. Benef√≠cios e promo√ß√µes s√£o definidos e concedidos exclusivamente pelos parceiros,
  v√°lidos, em regra, para pagamentos √† vista em moeda corrente, salvo autoriza√ß√£o expressa do estabelecimento.
</footer>
</body>
</html>
